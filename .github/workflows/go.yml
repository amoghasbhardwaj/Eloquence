# ==============================================================================
# FILE: .github/workflows/go.yml
# ==============================================================================
# PURPOSE: GitHub Actions workflow for Continuous Integration (CI).
#          Automatically builds, tests, and benchmarks the Eloquence project
#          on every push to the repository and every pull request.
# ==============================================================================

name: Eloquence CI

# Configure when this workflow runs
on:
  push:
    branches: [ "main" ] # Run on pushes to the main branch
  pull_request:
    branches: [ "main" ] # Run on pull requests targeting the main branch

# Define the jobs to be executed
jobs:
  build_and_test:
    name: Build & Test
    runs-on: ubuntu-latest # Run on a fresh Ubuntu virtual machine

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3 # Action to clone the repository

    - name: Set up Go Environment
      uses: actions/setup-go@v4 # Action to install a specific Go version
      with:
        go-version: '1.20' # Specify the Go version to use (matching go.mod)
        cache: true # Enable caching for Go modules for faster builds

    - name: Download Go Modules
      run: go mod download # Download project dependencies

    - name: Run All Tests (Unit, Integration, Sanity)
      # -v for verbose output, ensuring all test details are shown
      run: go test -v ./...

    - name: Run System Tests
      # Specifically run the system-level tests in the 'tests' directory
      run: go test -v ./tests

    - name: Run Benchmarks
      # -bench=. runs all benchmarks, -benchmem shows memory allocations
      run: go test -bench=. -benchmem ./...
      # Capture benchmark results if you want to track performance trends
      # For example, using a benchmark analysis tool or uploading artifacts